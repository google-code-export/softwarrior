<!DOCTYPE HTML>
<html>
  <head>
    <style>
    canvas {
        border: 1px solid #9C9898;
    }
    </style>
    <!--
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width; height=device-height; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"></meta>
    -->
    <title>Test Zoom</title>
    <script src="JS/kinetic_debug.js"></script>
    <script>
        function getDistance(touch1, touch2){
            var x1 = touch1.clientX;
            var x2 = touch2.clientX;
            var y1 = touch1.clientY;
            var y2 = touch2.clientY;
 
            return Math.sqrt(((x2 - x1) * (x2 - x1)) + ((y2 - y1) * (y2 - y1)));
        }
        window.onload = function(){
            var stage = new Kinetic.Stage({
              container: "container",
              width: 578,
              height: 200
            });

            var layer = new Kinetic.Layer();
            var startDistance = undefined;
            var startScale = 1;
 
            var triangle = new Kinetic.RegularPolygon({
                x: 190,
                y: 120,
                sides: 3,
                radius: 80,
                fill: "#00D2FF",
                stroke: "black",
                strokeWidth: 4
            });
 
            var circle = new Kinetic.Circle({
                x: 380,
                y: stage.getHeight() / 2,
                radius: 70,
                fill: "red",
                stroke: "black",
                strokeWidth: 4
            });

            stage._onContent("touchmove", function(evt){
                var touch1 = evt.touches[0];
                var touch2 = evt.touches[1];
 
                if (touch1 && touch2) {
                    if (startDistance === undefined) {
                        startDistance = getDistance(touch1, touch2);
                    }
                    else {
                        var dist = getDistance(touch1, touch2);
                        var scale = (dist / startDistance) * startScale;
                        var stageWidth = stage.getWidth() * scale;
                        var stageHeight = stage.getHeight() * scale;
                        
                        stage.setSize(stageWidth, stageHeight);
                        stage.setScale(scale);
 
                        // center layer
                        var x = stage.getWidth() * (1 - scale) / 2;
                        var y = stage.getHeight() * (1 - scale) / 2;
                        layer.setPosition(x, y);
                        
                        layer.draw();
                        stage.draw();
                    }
                }
            });
 
            stage._onContent("touchend", function(){
                startDistance = undefined;
                startScale = stage.getScale().x;
            });

            layer.add(triangle);
            layer.add(circle);

            stage.add(layer);
            
            layer.draw();
            stage.draw();
            
            startScale = stage.getScale().x;
        };
    </script>
  </head>
  <body onmousedown="return false;">
    <div id="container"></div>
  </body>
</html>
